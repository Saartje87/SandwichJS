/*!
 * SandwichJS v0.0.1
 * https://github.com/Saartje87/SandwichJS
 *
 * Copyright 2014 Niek Saarberg
 * Licensed MIT
 *
 * Build date 2014-xxxxxxxxx
 */
!function(a,b,c){this[a]=c(b)}("Sandwich",this,function(){"use strict";var a={};a.Log=function(){},a.Error=function(){},a.assert=function(a,b){if(a!==!0)throw Error(b)};var b={};return a.setNS=function(a,c){for(var d=a.split("."),e=b,f=d.pop(),g=0;g<d.length;g++)e[d[g]]||(e[d[g]]={}),e=e[d[g]];e[f]=c},a.getNS=function(a){for(var c=a.split("."),d=b,e=0;e<c.length;e++){if(!d[c[e]])return void 0;d=d[c[e]]}return d},a.module=function(b,c,d){if(d?c=c.map(a.getNS):(d=c,c=null),b&&!d)return a.getNS(b);if("string"!=typeof b&&console.warn("Sandwich.module::namespace must be a string"),"function"!=typeof d&&console.warn("Sandwich.module::module definition must be function"),a.getNS(b))throw console.warn("Sandwich.module::module `"+b+"` already declared"),Error();a.setNS(b,d.apply(null,c||[]))},a.module("Application",function(){function b(){console.info("Run Sandwich"),e||(PB.each(d,function(b,c){a[b]=c()}),e=!0)}function c(a,b){d[a]=b}var d={},e=!1;return{run:b,register:c}}),a.Application=a.module("Application"),a.module("Route",function(){function a(){console.log("Router.match")}function b(a,b,d){e.push({route:a,matches:c(a),callback:b,context:d})}function a(a){for(var b,c,d=0;d<e.length;d++)if(b=e[d].matches(a)){c=e[d];break}return c?{route:c.route,callback:c.callback,params:b}:!1}function c(a){for(var b="^",c="",e=0,f=a.length;f>e;e++)switch(c=a[e]){case"/":b+="\\/";break;case":":e=d(e,a),b+="([a-z0-9.\\s_-]+)";break;case"*":e=d(e,a),b+="(.*)";break;default:b+=c}return b+="$",b=new RegExp(b,"i"),function(a){var c=a.match(b);return c?Array.prototype.slice.call(c,1):null}}function d(a,b){for(a+=1;a<b.length;a++)if(!/[a-zA-Z0-9]/.test(b[a]))return a-1;return a}var e=[];return{name:"Route",match:a,register:b}}),a.module("Router",["Route"],function(b){function c(b){b||(b={}),b.router||(b.router="Hash"),h=a.module("Router.API."+b.router),a.assert("object"===PB.type(h),"router api not found `Router.API."+b.router+"`"),h.on("change",g),h.start()}function d(c,d,e){a.assert("string"===PB.type(c),"Router.when route argument expected to be a string"),a.assert("function"===PB.type(d),"Router.when callback argument expected to be a function"),c=f(c),b.register(c,d,e)}function e(a){var c;a=f(a),c=b.match(a),c&&c.callback.apply(c.callback,c.params)}function f(a){return a.replace(/^#?\!?/,"").replace(/^\/\/+/g,"/").replace(/^[\/|\s]+|[\/|\s]+$/g,"")}function g(a){e(a)}var h;return{start:c,when:d,run:e}}),a.Application.register("Router",function(){var b=a.module("Router");return b.start(),b}),a.module("Router.API.Hash",["Router"],function(b){function c(a,b,c){f.on(a,b,c)}function d(){a.assert("onhashchange"in window,"onhashchange event not supported by browser"),PB.$(window).on("hashchange",e),PB.ready(e)}function e(a){"string"!=typeof a&&(a=window.location.hash),b.run(a)}var f=new PB.Observer;return{name:"Router.API.Hash",start:d,on:c}}),a.module("Router.API.Pushstate",["Router"],function(b){function c(a,b,c){f.on(a,b,c)}function d(){a.assert("onhashchange"in window,"onhashchange event not supported by browser"),PB.$(window).on("hashchange",e),PB.ready(e)}function e(a){"string"!=typeof a&&(a=window.location.hash),b.run(a)}var f=new PB.Observer;return{name:"Router.API.Hash",start:d,on:c}}),a});